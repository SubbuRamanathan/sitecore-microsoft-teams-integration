---
ID: "686ac876-2378-4969-b9f7-f149d9225cfc"
Parent: "2da9e563-d99f-49ca-8e7b-b067c73c1d3f"
Template: "dd22f1b3-bd87-4db2-9e7d-f7a496888d43"
Path: "/sitecore/system/Modules/PowerShell/Script Library/Sitecore + Microsoft Teams Integration/Functions/Setup/Launch-ModuleOptions"
SharedFields:
- ID: "b1a94ff0-6897-47c0-9c51-aa6acb80b1f0"
  Hint: Script
  Value: |
    function Launch-ModuleOptions{
        Import-Function Inject-Scripts
        
        Inject-Scripts
        
        $webhookItems = Get-ChildItem -Path master: -ID "{AAEB319C-3BC9-411F-B0B9-721B5826AD0F}"
        $generalSettingsItem = Get-Item -Path master: -ID "{DD896673-142D-446D-8C02-E6C52A184706}"
        $executeScriptCommand = "item:executescript(script={0},scriptDb=master)"
        
        $connectorTab = @(
        	@{ Tab="CONNECTOR"; Name="webhooksTitle"; Title="Teams Endpoints"; Editor="info"; ParentGroupId=1; HideOnValue="0"; }
        )
        
        if($webhookItems.Count -eq 0){
           $connectorTab += @{ Tab="CONNECTOR"; Name="webhooksInfo"; Title=""; Value="No Teams Endpoint configured. Add a Teams Endpoint using the below link" ; Editor="info"; ParentGroupId=1; HideOnValue="0"; }
        }
        
        $webhookItems | ForEach-Object { 
            $editEndPointScript = Get-Item -Path "master:$($_.Paths.FullPath)/Scripts/Edit"
            $deleteEndPointScript = Get-Item -Path "master:$($_.Paths.FullPath)/Scripts/Delete"
            $options = [ordered]@{ "Edit" = $executeScriptCommand -f $editEndPointScript.ID.ToString() ; "Delete" = $executeScriptCommand -f $deleteEndPointScript.ID.ToString() }
            $connectorTab += @{ Tab="CONNECTOR"; Name=$_.Name; Value=$_["NickName"]; Title=""; Editor="info"; Columns=4; ParentGroupId=1; HideOnValue="0"; }
            $connectorTab += @{ Tab="CONNECTOR"; Name="$($_.Name)_Options"; Title=""; Options=$options; Editor="link"; Columns=6; ParentGroupId=1; HideOnValue="0"; }
        }
        
        $addOption = [ordered]@{ "Add New Teams Endpoint" = $executeScriptCommand -f "{5BD1ACCC-E98D-49C5-953A-741501F0A5DD}" }
        $connectorTab += @{ Tab="CONNECTOR"; Name="addEndpoint"; Title=""; Options=$addOption; Editor="link"; ParentGroupId=1; HideOnValue="0"; }
        
        $preferredEditor = $generalSettingsItem.PreferredEditor.Split('|') | Foreach-Object { Get-Item -Path master: -ID $_ }
        
        $optionsTab = @(
            @{ Tab="OPTIONS"; Name="pagespeedApiKey"; Title="Google PageSpeed API Key"; Value=$generalSettingsItem.PageSpeedAPIKey; Placeholder="Enter Google PageSpeed Insights API Key"; ParentGroupId=1; HideOnValue="0"; },
            @{ Tab="OPTIONS"; Name="preferredEditor"; Title="Please select preferred editor(s)";  Editor="multilist"; Tooltip="";
                Source="DataSource=/sitecore/system/Modules/PowerShell/Script Library/Sitecore + Microsoft Teams Integration/Editor Options&DatabaseName=master"; }
        )
        
        $aboutTab = @(
        	@{ Tab="ABOUT"; Name="About"; Value="$webhookEndPointsDescription"; Editor="info" }
        )
        
        $allTabs = $connectorTab + $optionsTab + $aboutTab
        
        $dialogProps = @{
            Title="Sitecore + Microsoft Teams Integration"
            Description="Lists all the notification settings with options to configure"
            Width=500 
            Height=600
            OkButtonName="Save"
            CancelButtonName="Close"
            ShowHints=$true
            Parameters=$allTabs
        }
        
        $result = Read-Variable @dialogProps
        
        if($result -eq "ok") {
            Set-ItemProperty -Path "master:$($generalSettingsItem.ItemPath)" -Name "PageSpeedAPIKey" -Value $pagespeedApiKey
            Set-ItemProperty -Path "master:$($generalSettingsItem.ItemPath)" -Name "PreferredEditor" -Value $preferredEditor
            Invoke-Javascript "window.top.location.reload()"
        }
        else{
            Invoke-Javascript "window.open('/sitecore/client/Applications/Launchpad', '_self')"
        }
    }
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20210530T014114Z
    - ID: "52807595-0f8f-4b20-8d2a-cb71d28c6103"
      Hint: __Owner
      Value: |
        sitecore\Admin
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\Admin
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "917a3a9e-6e3c-4b61-9e34-3fe7ed7072b8"
    - ID: "badd9cf9-53e0-4d0c-bcc0-2d784c282f6a"
      Hint: __Updated by
      Value: |
        sitecore\Admin
    - ID: "d9cf14b1-fa16-4ba6-9288-e8a174d4d522"
      Hint: __Updated
      Value: 20210601T183827Z
